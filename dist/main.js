(()=>{const e=document.querySelector(".content"),t=document.querySelector("nav"),n=document.querySelector("#modal");let l=document.getElementsByClassName("close")[0];const o=document.querySelector("#catModal");let s=document.getElementsByClassName("closeCatModal")[0];const a=document.querySelector(".tasksContainer");let d=document.querySelector("form"),i=document.getElementById("pageTitle");const c=document.getElementById("collapseBtn"),r=document.getElementById("createTask"),u=document.getElementById("okTaskBtn"),m=document.getElementById("cancelTaskBtn"),g=document.getElementById("delete"),y=document.getElementById("newCatBtn"),p=document.getElementById("okCatBtn"),k=document.getElementById("cancelCatBtn");let v=document.getElementById("title"),E=document.getElementById("category"),f=document.getElementById("dueDate"),h=document.getElementById("priority"),I=document.getElementById("description"),C="All Inbox",L=W(),B=document.querySelectorAll(".catBtns"),b=Math.max(...Array.from(B).map((e=>parseInt(e.dataset.catId)))),x=0;class D{constructor(e,t,n,l,o,s){this.id=e,this.title=t,this.category=n,this.dueDate=l,this.priority=o,this.description=s,this.complete=!1}toggleComplete(){this.complete=!this.complete}}function w(e){console.log(e),v.value=e.title,E.value=e.category.name,f.value=e.dueDate,h.value=e.priority,I.value=e.description,v.dataset.editingTaskId=e.id,n.style.display="block"}function S(e){const t=new Date(e),n=t.getTimezoneOffset();return t.setMinutes(t.getMinutes()+n),`${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")}/${t.getFullYear()}`}function T(e){if(!confirm("Are you sure you want to delete this task?"))return n.style.display="none",void delete v.dataset.editingTaskId;let t,l,o=document.getElementById(e);if(!o)return console.error(`No task div found with id ${e}`),void delete v.dataset.editingTaskId;for(let n of A)if(t=n.tasks.find((t=>t.id==e)),t){l=n;break}l.removeTaskFromCat(e),x--,x=A.reduce(((e,t)=>e+t.tasks.length),0);let s=o.parentNode;s&&s.nextElementSibling&&"HR"===s.nextElementSibling.tagName&&s.nextElementSibling.remove(),s.remove(),n.style.display="none",delete v.dataset.editingTaskId}r.addEventListener("click",(function(){v.value="",E.value="All Inbox";let e=new Date,t=String(e.getDate()).padStart(2,"0"),l=String(e.getMonth()+1).padStart(2,"0"),o=e.getFullYear();e=o+"-"+l+"-"+t,f.value=e,h.value="Low",I.value="",n.style.display="block"})),m.addEventListener("click",(function(e){e.preventDefault(),n.style.display="none"})),u.addEventListener("click",(function(e){if(document.querySelector("form").reportValidity()){e.preventDefault(),v.classList.remove("error");let t=document.getElementById("title").value,l=document.getElementById("category").value,o=document.getElementById("category").value,s=A.find((e=>e.name===o)),d=document.getElementById("dueDate").value,i=document.getElementById("priority").value,c=document.getElementById("description").value;v.dataset.editingTaskId?function(e,t,l,o,s){let a,d=v.dataset.editingTaskId;for(let e of A)if(a=e.tasks.find((e=>e.id==d)),a)break;if(void 0===a)return void console.error(`No task found with id ${d}`);a.title=e,a.category=t,a.dueDate=l,a.priority=o,a.description=s,console.log("editing task, title: "+e+" id: "+d);let i=document.getElementById(d);i.querySelector(".taskTitle").textContent=e,i.querySelector(".taskCategory").textContent=`(${t.name})`,i.querySelector(".taskDueDate").textContent=S(l),i.querySelector(".symbol").src="Highest"==o?"./images/warning-333.png":"High"==o?"./images/warning-222.png":"Medium"==o?"./images/warning-111.png":"./images/warning_grey.png",delete v.dataset.editingTaskId,n.style.display="none",Y(L,C)}(t,s,d,i,c):function(e,t,n,l,o,s){let d=new D(x,e,n,l,o,s);x++,console.log(n),n.addTaskToCat(d);let i=d.id;const c=document.createElement("div");c.classList.add("taskContainerDiv"),function(e,t,n,l,o,s){const i=document.createElement("div");i.classList.add("taskBigDiv");const r=document.createElement("div");r.classList.add("taskDiv"),r.id=e,r.dataset.taskId=e,r.addEventListener("click",(function(){w(d)}));const u=document.createElement("div");u.classList.add("taskPrim"),r.appendChild(u);const m=document.createElement("input");m.type="checkbox",m.addEventListener("click",(function(e){e.stopPropagation(),this.checked?(g.classList.add("complete"),y.classList.add("complete"),k.classList.add("complete"),v.classList.add("complete")):(g.classList.remove("complete"),y.classList.remove("complete"),k.classList.remove("complete"),v.classList.remove("complete"))}));const g=document.createElement("div");g.classList.add("taskTitle"),g.textContent=t;const y=document.createElement("div");y.classList.add("taskCategory"),y.textContent="("+n+")",u.appendChild(m),u.appendChild(g),u.appendChild(y);const p=document.createElement("div");p.classList.add("taskSec"),r.appendChild(p);const k=document.createElement("div");k.classList.add("taskDueDate"),k.textContent=S(l);const v=document.createElement("div");v.classList.add("taskDueDate");const E=document.createElement("img");"Highest"==s.value?E.src="./images/warning-333.png":"High"==s.value?E.src="./images/warning-222.png":"Medium"==s.value?E.src="./images/warning-111.png":E.src="./images/warning_grey.png",E.classList.add("symbol"),v.appendChild(E);const f=document.createElement("img");f.id=e,f.src="./images/delete.png",f.classList.add("symbol"),f.addEventListener("click",(function(e){e.stopPropagation();let t=f.id;t?T(t):console.log("No task is currently being edited")})),p.appendChild(k),p.appendChild(v),i.appendChild(r),i.appendChild(f);const h=document.createElement("hr");c.appendChild(i),c.appendChild(h),a.appendChild(c)}(i,e,t,l,0,h),Y(L,C)}(t,l,s,d,i,c),n.style.display="none"}else v.classList.add("error")})),g.addEventListener("click",(function(e){e.stopPropagation();let t=v.dataset.editingTaskId;t?T(t):console.log("No task is currently being edited")})),v.addEventListener("input",(function(){this.classList.remove("error")}));class q{constructor(e,t,n=null){this.name=e,this.color=t,this.tasks=[],this.catId=n||++b}addTaskToCat(e){this.tasks.push(e),e.id=x,x++}removeTaskFromCat(e){this.tasks=this.tasks.filter((t=>t.id!==e))}}let F,M=function(){const e=document.querySelectorAll(".categoriesDiv button");return Array.from(e).map((e=>{let t=parseInt(e.dataset.catId);return t>b&&(b=t),new q(e.textContent.trim(),null,t)}))}(),A=[...M],N=null;y.addEventListener("click",(function(){N="new",o.style.display="block"})),i.addEventListener("click",(function(){F=parseInt(this.dataset.catId),N="edit",function(e,t){console.log("Editing category with ID:",t),console.log(e.textContent),console.log(e.style.backgroundColor);let n=document.getElementById("catTitle"),l=document.getElementById("colorDisplay");n.value=e.textContent,l.style.backgroundColor=e.style.backgroundColor,o.style.display="block"}(i,F)})),p.addEventListener("click",(function(e){if(e.preventDefault(),"new"===N){let e=document.getElementById("catTitle").value,t=document.getElementById("colorPicker").value,n=new q(e,t);A.push(n);let l=document.createElement("li"),o=document.createElement("button");o.innerText=e,o.classList.add("catBtns"),o.style.backgroundColor=t,o.dataset.catId=n.catId,$(t)?o.style.color="white":o.style.color="black",l.appendChild(o),document.getElementById("categoriesList").appendChild(l)}else if("edit"===N){"number"!=typeof F&&console.error("catId is not a number at [description of the code location]",F);let e=A.find((e=>e.catId===F));if(e){e.name=document.getElementById("catTitle").value,e.color=document.getElementById("colorPicker").value;let t=document.querySelector(`button[data-cat-id="${F}"]`);t&&(t.innerText=e.name,t.style.backgroundColor=e.color,$(e.color)?t.style.color="white":t.style.color="black")}else console.error("Could not find category with ID:",F)}!function(){let e=document.getElementById("category");for(;e.firstChild;)e.removeChild(e.firstChild);A.forEach((t=>{let n=document.createElement("option");n.value=t.name,n.textContent=t.name,e.appendChild(n)}))}(),z(),o.style.display="none"})),k.addEventListener("click",(function(){}));const H=document.getElementById("colorPicker");H.value="#8a59b9";const P=document.getElementById("colorDisplay");function $(e){let t;return t=e.startsWith("#")?{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16)}:e,Math.round((299*t.r+587*t.g+114*t.b)/1e3)<170}function z(){const e=document.getElementById("allBtn"),t=document.getElementById("todayBtn"),n=document.getElementById("thisWeekBtn"),l=document.getElementById("thisMonthBtn"),o=document.getElementById("pageTimeline");function s(){n.classList.remove("selectedFilter"),l.classList.remove("selectedFilter"),e.classList.remove("selectedFilter"),t.classList.remove("selectedFilter")}t.addEventListener("click",(function(){const e=W();L=e,Y(L,C),s(),t.classList.add("selectedFilter"),o.textContent=this.textContent})),n.addEventListener("click",(function(){const e=W(),t=new Date;t.setDate(e.getDate()+7),L=t,Y(L,C),s(),n.classList.add("selectedFilter"),o.textContent=this.textContent})),l.addEventListener("click",(function(){const e=W(),t=new Date;t.setDate(e.getDate()+30),L=t,Y(L,C),s(),l.classList.add("selectedFilter"),o.textContent=this.textContent})),e.addEventListener("click",(function(){L=null,Y(L,C),s(),e.classList.add("selectedFilter"),o.textContent=this.textContent,e.classList.add("selectedFilter")}));let a=document.querySelectorAll(".catBtns");function d(e){let t=window.getComputedStyle(e),n=t.backgroundColor,l=t.color;i.style.backgroundColor=n,i.style.color=l}a.forEach((e=>{e.addEventListener("click",(function(){a.forEach((e=>{e.classList.remove("selectedFilter")})),this.classList.add("selectedFilter"),C=this.textContent,F=parseInt(this.dataset.catId),d(this),Y(L,C,F)}))})),function(){let e=document.getElementById("inboxBtn");e.classList.add("selectedFilter"),d(e),document.getElementById("allBtn").classList.add("selectedFilter")}()}function W(){const e=new Date;return e.setHours(0,0,0,0),e}function Y(e,t,n){document.querySelectorAll(".taskContainerDiv").forEach((n=>{const l=function(e){for(const t of A){const n=t.tasks.find((t=>t.id==e));if(n)return n}return null}(n.querySelector(".taskDiv").dataset.taskId),o=new Date(S(l.dueDate));o.setHours(0,0,0,0);const s=l.category;!(null===e||o<=e)||"All Inbox"!==t&&s.name!==t?n.style.display="none":n.style.display="block"})),i.textContent=t,i.dataset.catId=n}P.addEventListener("click",(function(){H.click()})),H.addEventListener("input",(function(){P.style.background=H.value})),z(),c.addEventListener("click",(function(){const n=window.getComputedStyle(t).display;window.innerWidth<750?"none"===n?(t.style.display="block",t.style.zIndex="2",e.style.gridColumn="1 / 3",e.classList.add("overlay"),c.src="./images/collapse3.png"):(t.style.display="none",t.style.zIndex="",e.style.gridColumn="1 / -1",e.classList.remove("overlay"),console.log("expand"),c.src="./images/expand3.png"):"none"===n?(t.style.display="block",t.style.zIndex="",e.style.gridColumn="2/3",e.classList.remove("overlay"),c.src="./images/collapse3.png"):(t.style.display="none",t.style.zIndex="",e.style.gridColumn="1 / -1",e.classList.remove("overlay"),console.log("expand"),c.src="./images/expand3.png")})),l.onclick=function(){n.style.display="none",delete v.dataset.editingTaskId},s.onclick=function(){o.style.display="none"},window.onclick=function(e){e.target==n?n.style.display="none":e.target==o&&(o.style.display="none")},d.addEventListener("keydown",(function(e){"Enter"===e.key&&(e.preventDefault(),u.click())}))})();